{"version":3,"sources":["../../../src/plugins/update.ts"],"names":["modifyjs","update","updateObj","oldDocData","_data","newDocData","_saveData","RxQueryUpdate","exec","then","docs","Array","isArray","Promise","all","map","doc","RxDBUpdatePlugin","name","rxdb","prototypes","RxDocument","proto","RxQuery"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,QAAP,MAAqB,UAArB;AAOA,OAAO,SAASC,MAAT,CAAkCC,SAAlC,EAAkD;AACrD,MAAMC,UAAU,GAAG,KAAKC,KAAxB;AACA,MAAMC,UAAU,GAAGL,QAAQ,CAACG,UAAD,EAAaD,SAAb,CAA3B;AACA,SAAO,KAAKI,SAAL,CAAeD,UAAf,EAA2BF,UAA3B,CAAP;AACH;AAED,OAAO,SAASI,aAAT,CAEHL,SAFG,EAGS;AACZ,SAAO,KAAKM,IAAL,GACFC,IADE,CACG,UAAAC,IAAI,EAAI;AACV,QAAI,CAACA,IAAL,EAAW;AACP,aAAO,IAAP;AACH;;AACD,QAAIC,KAAK,CAACC,OAAN,CAAcF,IAAd,CAAJ,EAAyB;AACrB,aAAOG,OAAO,CAACC,GAAR,CACHJ,IAAI,CAACK,GAAL,CAAS,UAAAC,GAAG;AAAA,eAAIA,GAAG,CAACf,MAAJ,CAAWC,SAAX,CAAJ;AAAA,OAAZ,CADG,EAELO,IAFK,CAEA;AAAA,eAAMC,IAAN;AAAA,OAFA,CAAP;AAGH,KAJD,MAIO;AACH;AACA,aAAOA,IAAI,CAACT,MAAL,CAAYC,SAAZ,EAAuBO,IAAvB,CAA4B;AAAA,eAAMC,IAAN;AAAA,OAA5B,CAAP;AACH;AACJ,GAbE,CAAP;AAcH;AAGD,OAAO,IAAMO,gBAA0B,GAAG;AACtCC,EAAAA,IAAI,EAAE,QADgC;AAEtCC,EAAAA,IAAI,EAAE,IAFgC;AAGtCC,EAAAA,UAAU,EAAE;AACRC,IAAAA,UAAU,EAAE,oBAACC,KAAD,EAAgB;AACxBA,MAAAA,KAAK,CAACrB,MAAN,GAAeA,MAAf;AACH,KAHO;AAIRsB,IAAAA,OAAO,EAAE,iBAACD,KAAD,EAAgB;AACrBA,MAAAA,KAAK,CAACrB,MAAN,GAAeM,aAAf;AACH;AANO;AAH0B,CAAnC","sourcesContent":["/**\n * this plugin allows delta-updates with mongo-like-syntax\n * It's using modifyjs internally\n * @link https://github.com/lgandecki/modifyjs\n */\nimport modifyjs from 'modifyjs';\nimport type {\n    RxDocument,\n    RxQuery,\n    RxPlugin\n} from '../types';\n\nexport function update(this: RxDocument, updateObj: any) {\n    const oldDocData = this._data;\n    const newDocData = modifyjs(oldDocData, updateObj);\n    return this._saveData(newDocData, oldDocData);\n}\n\nexport function RxQueryUpdate(\n    this: RxQuery,\n    updateObj: any\n): Promise<any> {\n    return this.exec()\n        .then(docs => {\n            if (!docs) {\n                return null;\n            }\n            if (Array.isArray(docs)) {\n                return Promise.all(\n                    docs.map(doc => doc.update(updateObj))\n                ).then(() => docs);\n            } else {\n                // via findOne()\n                return docs.update(updateObj).then(() => docs);\n            }\n        });\n}\n\n\nexport const RxDBUpdatePlugin: RxPlugin = {\n    name: 'update',\n    rxdb: true,\n    prototypes: {\n        RxDocument: (proto: any) => {\n            proto.update = update;\n        },\n        RxQuery: (proto: any) => {\n            proto.update = RxQueryUpdate;\n        }\n    }\n};\n"],"file":"update.js"}