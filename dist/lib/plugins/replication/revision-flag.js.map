{"version":3,"sources":["../../../../src/plugins/replication/revision-flag.ts"],"names":["getPullReplicationFlag","replicationIdentifierHash","setLastWritePullReplication","documentData","revisionHeight","_meta","wasLastWriteFromPullReplication","lastRevision","_rev","replicationFlagValue","height"],"mappings":";;;;;;;;;AASA;;AATA;AACA;AACA;AACA;AACA;AACA;AACA;AAQO,SAASA,sBAAT,CACHC,yBADG,EAEL;AACE,SAAO,SAASA,yBAAhB;AACH;AAGD;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,2BAAT,CACHD,yBADG,EAEHE,YAFG;AAGH;AACJ;AACA;AACA;AACIC,cAPG,EAQL;AACED,EAAAA,YAAY,CAACE,KAAb,CAAmBL,sBAAsB,CAACC,yBAAD,CAAzC,IAAwEG,cAAxE;AACH;;AAEM,SAASE,+BAAT,CACHL,yBADG,EAEHE,YAFG,EAGI;AACP,MAAMI,YAAY,GAAG,yBAAcJ,YAAY,CAACK,IAA3B,CAArB;;AACA,MAAMC,oBAAwC,GAAGN,YAAY,CAACE,KAAb,CAAmBL,sBAAsB,CAACC,yBAAD,CAAzC,CAAjD;;AAEA,MACIQ,oBAAoB,IACpBF,YAAY,CAACG,MAAb,KAAwBD,oBAF5B,EAGE;AACE,WAAO,IAAP;AACH,GALD,MAKO;AACH,WAAO,KAAP;AACH;AACJ","sourcesContent":["/**\n * The replication handler needs to know\n * which local documents have been lastly written locally\n * and which came from the remote.\n * To determine this, we 'flag' the document\n * by setting a specially crafted revision string.\n */\n\nimport type { DeepReadonly, RxDocumentData, RxDocumentWriteData } from '../../types';\nimport {\n    parseRevision\n} from '../../util';\n\n\nexport function getPullReplicationFlag(\n    replicationIdentifierHash: string\n) {\n    return 'rep-' + replicationIdentifierHash;\n}\n\n\n/**\n * Sets the pull replication flag to the _meta\n * to contain the next revision height.\n * Used to identify the document as 'pulled-from-remote'\n * so we do not send it to remote again.\n */\nexport function setLastWritePullReplication<RxDocType>(\n    replicationIdentifierHash: string,\n    documentData: RxDocumentData<RxDocType> | RxDocumentWriteData<RxDocType>,\n    /**\n     * Height of the revision\n     * with which the pull flag will be saved.\n     */\n    revisionHeight: number\n) {\n    documentData._meta[getPullReplicationFlag(replicationIdentifierHash)] = revisionHeight;\n}\n\nexport function wasLastWriteFromPullReplication<RxDocType>(\n    replicationIdentifierHash: string,\n    documentData: RxDocumentData<RxDocType> | DeepReadonly<RxDocumentData<RxDocType>>\n): boolean {\n    const lastRevision = parseRevision(documentData._rev);\n    const replicationFlagValue: number | undefined = documentData._meta[getPullReplicationFlag(replicationIdentifierHash)] as any;\n\n    if (\n        replicationFlagValue &&\n        lastRevision.height === replicationFlagValue\n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}\n"],"file":"revision-flag.js"}